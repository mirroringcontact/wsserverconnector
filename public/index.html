
<!DOCTYPE html>
<html lang="en">

<head>
  <title>Screen Mirroring</title>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="description"
    content="Mirror your phone screen to any TV in realtime.">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
  <script src="qrcode.min.js" type="text/javascript"></script> 
  <style>
    html {
      height: 100%;
    }

    body {
      background: #d3d3d3;
      /* Old browsers */
      background: -moz-linear-gradient(top, #d3d3d3 0%, #b9b9b9 100%);
      /* FF3.6-15 */
      background: -webkit-linear-gradient(top, #d3d3d3 0%, #b9b9b9 100%);
      /* Chrome10-25,Safari5.1-6 */
      background: linear-gradient(to bottom, #d3d3d3 0%, #b9b9b9 100%) fixed;
      /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
      filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#d3d3d3 ', endColorstr='#b9b9b9', GradientType=0);
      /* IE6-9 */
    }

    h1 {
      font-family: sans-serif;
      font-size: 36px;
      font-weight: bold;
      text-align: center;
    }

    h2 {
      font-family: sans-serif;
      font-size: 20px;
      font-weight: bold;
      text-align: center;
    }

    p {
      font-family: sans-serif;
    }

    a {
      font-family: sans-serif;
      color: #000000;
      font-weight: bold;
      text-decoration: none
    }

    hr {
      float: none;
      border: 0;
      height: 1px;
      background: #333;
      background-image:
        linear-gradient(to right, #ccc, #333, #ccc);
    }

    #content {
      max-width: 780px;
      margin: 15px auto;
      background-color: white;
      border: 1px solid darkgrey;
      padding: 20px;
      border-radius: 5px;
    }

    #code {
      font-size: 50px;
      font-weight: 900;
      letter-spacing: 0.1em;
    }

    .center {
        display: block;
        margin-left: auto;
        margin-right: auto;
    }
    
  </style>
</head>

<body>
  <div id="content">
    <img src='appicon.png' width="75" height="75" class='center'></img>
    <h1>Screen Mirroring</h1>
    <!-- <h2>Mirror your iPhone, iPad or Android phone screen to any TV in realtime.</h2> -->
    <p style="font-size: 16px;margin-top: 25px;">
      - Enter the code below into the Screen Mirroring App to start mirroring.
    </p>
    <div>
      <center>
        <b><span id="code"></span></b>
      </center>
    </div>
    <p style="font-size: 16px;">
      - Or scan the QR code
    </p>
    <div>
      <center>
        <div id="qrcode"></div>
      </center>
    </div>      
    </br>
    </br>
  </div>
  <script>
    const codeString = Math.floor(100000 + Math.random() * 900000).toString();
    document.getElementById('code').innerHTML = codeString;
    document.getElementById('qrcode').innerHTML = "";
    var qrcode = new QRCode('qrcode', {
      text: codeString,
      width: 250,
      height: 250,
      colorDark: '#000000',
      colorLight: '#FFFFFF',
      correctLevel: QRCode.CorrectLevel.H
    });
 
    const protocol = window.location.protocol.includes('https') ? 'wss': 'ws';
    const ws = new WebSocket(`${protocol}://${location.host}`);
    ws.onopen = function (event) {  
        ws.send(codeString);
    };
    ws.onmessage = function(event) {
      const data = event.data; 
      var redirectUrl = "http://" + data; 
      redirectUrl += "/webrtc.html"; 
      window.location.href = redirectUrl;
    };  
      
      function getURLParameters() {
          var params = {};
          var query = window.location.search.substring(1); // Исключаем символ '?'
          var vars = query.split("&");
          for (var i = 0; i < vars.length; i++) {
              var pair = vars[i].split("=");
              var key = decodeURIComponent(pair[0]);
              var value = decodeURIComponent(pair[1]);
              params[key] = value;
          }
          return params;
      }

      var urlParams = getURLParameters();
      var iOSIP = urlParams["ip"];
      if (iOSIP !== null && iOSIP !== "") {
          var redirectUrl = "http://" + iOSIP;
          redirectUrl += "/webrtc.html";
          window.location.href = redirectUrl;
          console.log("ios ip: ", iOSIP);
      }
  </script>
</body>

</html>
